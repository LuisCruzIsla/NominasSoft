/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5 		*/
/*  Created On : 02-Nov.-2019 22:26:24 				*/
/*  DBMS       : PostgreSQL 						*/
/* ---------------------------------------------------- */

/* Drop Sequences for Autonumber Columns */

DROP SEQUENCE IF EXISTS afp_afpid_seq
;

DROP SEQUENCE IF EXISTS conceptos_conceptocodigo_seq
;

DROP SEQUENCE IF EXISTS contratos_contratocodigo_seq
;

/* Drop Tables */

DROP TABLE IF EXISTS AFP CASCADE
;

DROP TABLE IF EXISTS Conceptos CASCADE
;

DROP TABLE IF EXISTS Contratos CASCADE
;

DROP TABLE IF EXISTS Empleados CASCADE
;

DROP TABLE IF EXISTS Pagos CASCADE
;

DROP TABLE IF EXISTS Periodos CASCADE
;

/* Create Tables */

CREATE TABLE AFP
(
	AFPId integer NOT NULL   DEFAULT NEXTVAL(('"afp_afpid_seq"'::text)::regclass),
	AFPDescuento numeric NOT NULL,
	AFPNombre varchar(50) NOT NULL
)
;

CREATE TABLE Conceptos
(
	ConceptoCodigo integer NOT NULL   DEFAULT NEXTVAL(('"conceptos_conceptocodigo_seq"'::text)::regclass),
	montoHorasExtras numeric(10,2) NOT NULL,
	montoReintegros numeric(10,2) NOT NULL,
	montoOtrosIngresos numeric(10,2) NOT NULL,
	montoHorasAusentes numeric(10,2) NOT NULL,
	montoAdelantos numeric(10,2) NOT NULL,
	montoOtrosDescuentos numeric(10,2) NOT NULL,
	ContratoCodigo integer NULL,
	PeriodoCodigo char(8) NULL
)
;

CREATE TABLE Contratos
(
	ContratoCodigo integer NOT NULL DEFAULT NEXTVAL(('"contratos_contratocodigo_seq"'::text)::regclass),
	ContratoFechaInicio date NOT NULL,
	ContratoFechaFin date NOT NULL,
	ContratoAsignacionFamiliar char(1) NOT NULL,
	ContratoTotalHorasSemanal integer NOT NULL,
	ContratoValorHoras numeric(10,2) NOT NULL,
	ContratoCargo varchar(50) NOT NULL,
	AFPId integer NULL,
	EmpleadoCodigo char(8) NULL,
	ContratoTipo char(1) NOT NULL DEFAULT 'N'
)
;

CREATE TABLE Empleados
(
	EmpleadoCodigo char(8) NOT NULL,
	EmpleadoNombre varchar(90) NOT NULL,
	EmpleadoDNI char(8) NOT NULL,
	EmpleadoDireccion varchar(150) NOT NULL,
	EmpleadoTelefono integer NOT NULL,
	EmpleadoFechaNacimiento date NOT NULL,
	EmpleadoEstadoCivil char(1) NOT NULL,
	EmpleadoGradoAcademico varchar(50) NOT NULL
)
;

CREATE TABLE Pagos
(
	PagoCodigo SERIAL NOT NULL,
	PagoAsignacionFamiliar numeric(10,2) NOT NULL,
	PagoFecha date NOT NULL,
	PagoPorcentajeAFP numeric(10,2) NOT NULL,
	PagoTotalHoras numeric(10,2) NOT NULL,
	PagoValorHoras numeric(10,2) NOT NULL,
	ContratoCodigo integer NULL,
	PeriodoCodigo char(8) NULL,
	ConceptoCodigo integer NULL
)
;

CREATE TABLE Periodos
(
	PeriodoCodigo char(8) NOT NULL,
	PeriodoFechaInicio date NOT NULL,
	PeriodoFechaFin date NOT NULL,
	PeriodoEstado char(1) NOT NULL DEFAULT 'E'
)
;


/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE AFP ADD CONSTRAINT AFPCodigoPK
	PRIMARY KEY (AFPId)
;

ALTER TABLE Conceptos ADD CONSTRAINT ConceptoCodigoPK
	PRIMARY KEY (ConceptoCodigo)
;

ALTER TABLE Contratos ADD CONSTRAINT ContratoCodigoPK
	PRIMARY KEY (ContratoCodigo)
;

ALTER TABLE Contratos ADD CONSTRAINT ContratoTipoCK CHECK (ContratoTipo = 'A' or ContratoTipo = 'N')
;

ALTER TABLE Empleados ADD CONSTRAINT EmpleadoCodigoPK
	PRIMARY KEY (EmpleadoCodigo)
;

ALTER TABLE Empleados ADD CONSTRAINT EmpleadoEstadoCivilCK CHECK (EmpleadoEstadoCivil = 'C' or EmpleadoEstadoCivil = 'S' OR EmpleadoEstadoCivil = 'D' OR EmpleadoEstadoCivil = 'V')
;

ALTER TABLE Pagos ADD CONSTRAINT PagoCodigoPK
	PRIMARY KEY (PagoCodigo)
;

ALTER TABLE Periodos ADD CONSTRAINT PeriodoCodigoPK
	PRIMARY KEY (PeriodoCodigo)
;

ALTER TABLE Periodos ADD CONSTRAINT PeriodoEstadoCK CHECK (PeriodoEstado = 'E' or PeriodoEstado = 'D')
;

/* Create Foreign Key Constraints */

ALTER TABLE Conceptos ADD CONSTRAINT ConceptoContratoCodigoFK
	FOREIGN KEY (ContratoCodigo) REFERENCES Contratos (ContratoCodigo) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE Conceptos ADD CONSTRAINT ConceptoPeriodoCodigoFK
	FOREIGN KEY (PeriodoCodigo) REFERENCES Periodos (PeriodoCodigo) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE Contratos ADD CONSTRAINT ContratoAFPIdFK
	FOREIGN KEY (AFPId) REFERENCES AFP (AFPId) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE Contratos ADD CONSTRAINT ContratoEmpleadoCodigoFK
	FOREIGN KEY (EmpleadoCodigo) REFERENCES Empleados (EmpleadoCodigo) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE Pagos ADD CONSTRAINT PagoConceptoCodigoFK
	FOREIGN KEY (ConceptoCodigo) REFERENCES Conceptos (ConceptoCodigo) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE Pagos ADD CONSTRAINT PagoContratoCodigoFK
	FOREIGN KEY (ContratoCodigo) REFERENCES Contratos (ContratoCodigo) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE Pagos ADD CONSTRAINT PagoPeriodoCodigoFK
	FOREIGN KEY (PeriodoCodigo) REFERENCES Periodos (PeriodoCodigo) ON DELETE No Action ON UPDATE No Action
;

/* Create Table Comments, Sequences for Autonumber Columns */

CREATE SEQUENCE afp_afpid_seq INCREMENT 1 START 1
;

CREATE SEQUENCE conceptos_conceptocodigo_seq INCREMENT 1 START 1
;

CREATE SEQUENCE contratos_contratocodigo_seq INCREMENT 1 START 1
;

INSERT INTO 
afp
VALUES 
(1,11.44,'Capital'),
(2,11.44,'Cuprum'),
(3,11.27,'Habitat'),
(4,10.41,'PlanVital'),
(5,11.45,'ProVida'),
(6,10.77,'Modelo');

insert into empleados(
	empleadocodigo,
	empleadonombre,
	empleadodni,
	empleadodireccion,
	empleadotelefono,
	empleadofechanacimiento,
	empleadoestadocivil,
	empleadogradoacademico)
values('TR-00000',
	   'Kevin Piazzoli Felix Perez',
	   '74061892',
	   'Mz. 16 A. Lt. 03 Villa Rosa Porvenir',
	   '962823909',
	   '05/06/1999',
	   'S',
	   'PROFESIONAL'
);

insert into empleados(
	empleadocodigo,
	empleadonombre,
	empleadodni,
	empleadodireccion,
	empleadotelefono,
	empleadofechanacimiento,
	empleadoestadocivil,
	empleadogradoacademico)
values('TR-00001',
	   'Kayra Oriana Espinoza Garcia',
	   '73698921',
	   'Las Flores Mz. G Lt. 15',
	   '974287283',
	   '02/01/1998',
	   'S',
	   'BACHILLER'
);
insert into empleados(
	empleadocodigo,
	empleadonombre,
	empleadodni,
	empleadodireccion,
	empleadotelefono,
	empleadofechanacimiento,
	empleadoestadocivil,
	empleadogradoacademico)
values('TR-00002',
	   'Luis Felipe Cruz Isla',
	   '73451110',
	   'San Andreas 5ta Etapa c"26',
	   '986675458',
	   '24/06/1998',
	   'S',
	   'BACHILLER'
);
insert into empleados(
	empleadocodigo,
	empleadonombre,
	empleadodni,
	empleadodireccion,
	empleadotelefono,
	empleadofechanacimiento,
	empleadoestadocivil,
	empleadogradoacademico)
values('TR-00003',
	   'Ronald Segundo Alva Mari√±os',
	   '74972186',
	   'Cerro de Pasco 170 #6',
	   '949901612',
	   '09/03/1999',
	   'S',
	   'PROFESIONAL'
);
insert into empleados(
	empleadocodigo,
	empleadonombre,
	empleadodni,
	empleadodireccion,
	empleadotelefono,
	empleadofechanacimiento,
	empleadoestadocivil,
	empleadogradoacademico)
values('TR-00004',
	   'Jesus Femin De Paz Eras',
	   '12121212',
	   'Av 123i82 Prueba',
	   '949992122',
	   '09/08/1999',
	   'S',
	   'PROFESIONAL'
);

insert into empleados(
	empleadocodigo,
	empleadonombre,
	empleadodni,
	empleadodireccion,
	empleadotelefono,
	empleadofechanacimiento,
	empleadoestadocivil,
	empleadogradoacademico)
values('TR-00005',
	   'Elias Perez Kevin',
	   '12345678',
	   'Av. Larco Mz. 16 A LT 08',
	   '945352373',
	   '10/10/1990',
	   'C',
	   'DOCTOR'
);

SELECT empleadocodigo,
	empleadonombre,
	empleadodni,
	empleadodireccion,
	empleadotelefono,
	empleadofechanacimiento,
	empleadoestadocivil,
	empleadogradoacademico
FROM empleados;

INSERT INTO public.contratos(
	contratofechainicio, 
	contratofechafin, 
	contratoasignacionfamiliar, 
	contratototalhorassemanal, 
	contratovalorhoras, 
	contratocargo, 
	afpid, 
	empleadocodigo
)
VALUES ( 
	'01/01/2019', 
	'01/12/2019', 
	'F', 
	40, 
	30, 
	'Administrador', 
	1, 
	'TR-00000'
);

INSERT INTO public.contratos(
	contratofechainicio, 
	contratofechafin, 
	contratoasignacionfamiliar, 
	contratototalhorassemanal, 
	contratovalorhoras, 
	contratocargo, 
	afpid, 
	empleadocodigo
)
VALUES (
	'01/01/2019', 
	'01/12/2019', 
	'T', 
	8, 
	20, 
	'Gerente', 
	2, 
	'TR-00001'
);

INSERT INTO public.contratos(
	contratofechainicio, 
	contratofechafin, 
	contratoasignacionfamiliar, 
	contratototalhorassemanal, 
	contratovalorhoras, 
	contratocargo, 
	afpid, 
	empleadocodigo
)
VALUES (
	'01/01/2019', 
	'01/12/2019', 
	'F', 
	40, 
	11, 
	'DBA', 
	3, 
	'TR-00002'
);

INSERT INTO public.contratos(
	contratofechainicio, 
	contratofechafin, 
	contratoasignacionfamiliar, 
	contratototalhorassemanal, 
	contratovalorhoras, 
	contratocargo, 
	afpid, 
	empleadocodigo
)
VALUES (
	'01/01/2019', 
	'01/12/2019', 
	'T', 
	8, 
	21, 
	'Administrador de Redes', 
	4, 
	'TR-00003'
);

INSERT INTO public.contratos(
	contratofechainicio, 
	contratofechafin, 
	contratoasignacionfamiliar, 
	contratototalhorassemanal, 
	contratovalorhoras, 
	contratocargo, 
	afpid, 
	empleadocodigo
)
VALUES (
	'01/01/2019', 
	'01/12/2019', 
	'F', 
	8, 
	40, 
	'Gerente de Software', 
	5, 
	'TR-00004'
);

select * from contratos;

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin,
	periodoestado
)
VALUES (
		'PD-00001', 
		'2019-01-01', 
		'2019-01-31',
		'D'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin,
	periodoestado
)
VALUES (
		'PD-00002', 
		'2019-02-01', 
		'2019-02-28',
		'D'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin,
	periodoestado
)
VALUES (
		'PD-00003', 
		'2019-03-01', 
		'2019-03-31',
		'D'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin,
	periodoestado
)
VALUES (
		'PD-00004', 
		'2019-04-01', 
		'2019-04-30',
		'D'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin,
	periodoestado
)
VALUES (
		'PD-00005', 
		'2019-05-01', 
		'2019-05-31',
		'D'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin,
	periodoestado
)
VALUES (
		'PD-00006', 
		'2019-06-01', 
		'2019-06-30',
		'D'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin,
	periodoestado
)
VALUES (
		'PD-00007', 
		'2019-07-01', 
		'2019-07-31',
		'D'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin,
	periodoestado
)
VALUES (
		'PD-00008', 
		'2019-08-01', 
		'2019-08-31',
		'D'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin
)
VALUES (
		'PD-00009', 
		'2019-09-01', 
		'2019-09-30'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin
)
VALUES (
		'PD-00010', 
		'2019-10-01', 
		'2019-10-31'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin,
	periodoestado
)
VALUES (
		'PD-00011', 
		'2019-11-01', 
		'2019-11-30',
		'D'
);

INSERT INTO public.periodos(
	periodocodigo, 
	periodofechainicio, 
	periodofechafin
)
VALUES (
		'PD-00012', 
		'2019-12-01', 
		'2019-12-31'
);

select * from periodos;

INSERT INTO public.conceptos(
	montohorasextras, 
	montoreintegros, 
	montootrosingresos, 
	montohorasausentes, 
	montoadelantos, 
	montootrosdescuentos, 
	contratocodigo, 
	periodocodigo
)
VALUES 

(0, 20, 20, 0, 0, 0, 1, 'PD-00001'),
(0, 10, 20, 0, 0, 10, 1, 'PD-00002'),
(0, 0, 20, 0, 0, 0, 1, 'PD-00003'),
(0, 0, 10, 0, 0, 20, 1, 'PD-00004'),
(0, 10, 20, 0, 0, 0, 1, 'PD-00005'),
(0, 0, 30, 10, 0, 10, 1, 'PD-00006'),
(0, 0, 20, 0, 0, 0, 1, 'PD-00007'),
(0, 10, 20, 0, 30, 0, 1, 'PD-00008'),
(0, 0, 20, 10, 0, 20, 1, 'PD-00009'),
(0, 0, 40, 0, 0, 0, 1, 'PD-00010'),
(0, 0, 20, 0, 0, 0, 1, 'PD-00011'),
(0, 0, 50, 10, 0, 20, 1, 'PD-00012'),

(10, 0, 20, 0, 0, 0, 2, 'PD-00001'),
(20, 0, 20, 0, 0, 0, 2, 'PD-00002'),
(20, 0, 20, 0, 0, 0, 2, 'PD-00003'),
(10, 0, 20, 0, 20, 0, 2, 'PD-00004'),
(15, 0, 20, 10, 0, 0, 2, 'PD-00005'),
(16, 0, 20, 10, 0, 0, 2, 'PD-00006'),
(30, 0, 20, 0, 0, 0, 2, 'PD-00007'),
(0, 0, 20, 0, 0, 0, 2, 'PD-00008'),
(0, 0, 20, 0, 0, 0, 2, 'PD-00009'),
(20, 0, 20, 0, 0, 10, 2, 'PD-00010'),
(30, 0, 20, 0, 0, 0, 2, 'PD-00011'),
(10, 0, 20, 0, 0, 20, 2, 'PD-00012'),

(0, 0, 20, 0, 0, 0, 3, 'PD-00001'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00002'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00003'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00004'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00005'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00006'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00007'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00008'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00009'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00010'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00011'),
(0, 0, 20, 0, 0, 0, 3, 'PD-00012'),

(0, 10, 20, 0, 0, 0, 4, 'PD-00001'),
(0, 0, 20, 0, 0, 0, 4, 'PD-00002'),
(0, 0, 20, 0, 0, 10, 4, 'PD-00003'),
(0, 10, 20, 0, 10, 0, 4, 'PD-00004'),
(0, 0, 20, 0, 0, 10, 4, 'PD-00005'),
(0, 10, 20, 0, 0, 0, 4, 'PD-00006'),
(0, 0, 20, 0, 10, 0, 4, 'PD-00007'),
(0, 0, 20, 0, 0, 0, 4, 'PD-00008'),
(0, 0, 20, 0, 0, 0, 4, 'PD-00009'),
(0, 10, 20, 0, 0, 0, 4, 'PD-00010'),
(0, 0, 20, 0, 0, 0, 4, 'PD-00011'),
(0, 0, 20, 0, 0, 10, 4, 'PD-00012'),

(0, 0, 20, 0, 0, 10, 5, 'PD-00001'),
(0, 0, 20, 0, 0, 0, 5, 'PD-00002'),
(0, 10, 20, 0, 10, 0, 5, 'PD-00003'),
(0, 0, 20, 10, 0, 0, 5, 'PD-00004'),
(0, 10, 20, 10, 0, 0, 5, 'PD-00005'),
(0, 10, 20, 0, 10, 0, 5, 'PD-00006'),
(0, 0, 20, 0, 10, 0, 5, 'PD-00007'),
(0, 0, 20, 0, 0, 10, 5, 'PD-00008'),
(0, 10, 20, 0, 0, 0, 5, 'PD-00009'),
(0, 0, 20, 10, 0, 10, 5, 'PD-00010'),
(0, 10, 20, 0, 0, 0, 5, 'PD-00011'),
(0, 0, 20, 0, 10, 0, 5, 'PD-00012');

select * from conceptos;

select * from pagos;





